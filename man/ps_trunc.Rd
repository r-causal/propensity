% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ps_trunc.R
\name{ps_trunc}
\alias{ps_trunc}
\title{Truncate (Winsorize) Propensity Scores}
\usage{
ps_trunc(
  ps,
  method = c("ps", "pctl", "cr"),
  lower = NULL,
  upper = NULL,
  .exposure = NULL,
  .treated = NULL,
  .untreated = NULL,
  ...
)
}
\arguments{
\item{ps}{The propensity score, either a numeric vector between 0 and 1 for
binary exposures, or a matrix/data.frame where each column represents
propensity scores for each level of a categorical exposure.}

\item{method}{One of \code{"ps"}, \code{"pctl"}, or \code{"cr"}.
\itemize{
\item \code{"ps"}: directly cut on \verb{[lower, upper]} of \code{ps}. For categorical, uses
symmetric truncation with \code{lower} as the threshold.
\item \code{"pctl"}: use quantiles of \code{ps} as bounding values. For categorical,
calculates quantiles across all propensity score values.
\item \code{"cr"}: the common range of \code{ps} given \code{.exposure}, bounding
\verb{[min(ps[treated]), max(ps[untreated])]} (binary only)
}}

\item{lower, upper}{Numeric or quantile bounds. If \code{NULL}, defaults vary by method.
For categorical exposures with method \code{"ps"}, \code{lower} represents the
truncation threshold (delta).}

\item{.exposure}{For method "cr", a binary exposure vector. For categorical
exposures, must be a factor or character vector.}

\item{.treated}{The value representing the treatment group. If not provided,
it is automatically detected.}

\item{.untreated}{The value representing the control group. If not provided,
it is automatically detected.}

\item{...}{Additional arguments passed to methods}
}
\value{
A \strong{\code{ps_trunc}} object (numeric vector or matrix). It has an attribute
\code{ps_trunc_meta} storing fields like \code{method}, \code{lower_bound}, and
\code{upper_bound}.
}
\description{
\strong{\code{ps_trunc()}} sets out‐of‐range propensity scores to fixed bounding values
(a form of \emph{winsorizing}). This is an alternative to \code{\link[=ps_trim]{ps_trim()}}, which removes
(sets \code{NA}) instead of bounding and is then refit with \code{\link[=ps_refit]{ps_refit()}}
}
\details{
For binary exposures with each \eqn{ps[i]}:
\itemize{
\item If \eqn{ps[i] < lower\_bound}, we set \eqn{ps[i] = lower\_bound}.
\item If \eqn{ps[i] > upper\_bound}, we set \eqn{ps[i] = upper\_bound}.
}

For categorical exposures:
\itemize{
\item Each value below the threshold is set to the threshold
\item Rows are renormalized to sum to 1
}

This approach is often called \emph{winsorizing}.
}
\examples{
set.seed(2)
n <- 30
x <- rnorm(n)
z <- rbinom(n, 1, plogis(0.4 * x))
fit <- glm(z ~ x, family = binomial)
ps <- predict(fit, type = "response")

# truncate just the 99th percentile
ps_trunc(ps, method = "pctl", lower = 0, upper = .99)

}
\seealso{
\code{\link[=ps_trim]{ps_trim()}} and \code{\link[=ps_refit]{ps_refit()}} for removing extreme values vs. bounding
}
