% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ps_trunc.R
\name{ps_trunc}
\alias{ps_trunc}
\title{Truncate (Winsorize) Propensity Scores}
\usage{
ps_trunc(
  ps,
  method = c("ps", "pctl", "cr"),
  lower = NULL,
  upper = NULL,
  .exposure = NULL,
  .treated = NULL,
  .untreated = NULL
)
}
\arguments{
\item{ps}{The propensity score, a numeric vector between 0 and 1.}

\item{method}{One of \code{"ps"}, \code{"pctl"}, or \code{"cr"}.
\itemize{
\item \code{"ps"}: directly cut on \verb{[lower, upper]} of \code{ps}.
\item \code{"pctl"}: use quantiles of \code{ps} as bounding values
\item \code{"cr"}: the common range of \code{ps} given \code{.exposure}, bounding \verb{[min(ps[treated]), max(ps[untreated])]}
}}

\item{lower, upper}{Numeric or quantile bounds. If \code{NULL}, defaults vary by method.}

\item{.exposure}{For method "cr", a binary exposure vector.}

\item{.treated}{The treatment level of the exposure. Automatically detected
by default.}

\item{.untreated}{The control level of the exposure. Automatically detected
by default.}
}
\value{
A \strong{\code{ps_trunc}} object (numeric vector). It has an attribute
\code{ps_trunc_meta} storing fields like \code{method}, \code{lower_bound}, and
\code{upper_bound}.
}
\description{
\strong{\code{ps_trunc()}} sets out‐of‐range propensity scores to fixed bounding values
(a form of \emph{winsorizing}). This is an alternative to \code{\link[=ps_trim]{ps_trim()}}, which removes
(sets \code{NA}) instead of bounding and is then refit with \code{\link[=ps_refit]{ps_refit()}}
}
\details{
For each \eqn{ps[i]}:
\itemize{
\item If \eqn{ps[i] < lower\_bound}, we set \eqn{ps[i] = lower\_bound}.
\item If \eqn{ps[i] > upper\_bound}, we set \eqn{ps[i] = upper\_bound}.
This approach is often called \emph{winsorizing}.
}
}
\examples{
set.seed(2)
n <- 30
x <- rnorm(n)
z <- rbinom(n, 1, plogis(0.4 * x))
fit <- glm(z ~ x, family = binomial)
ps <- predict(fit, type = "response")

# truncate just the 99th percentile
ps_trunc(ps, method = "pctl", lower = 0, upper = .99)

}
\seealso{
\code{\link[=ps_trim]{ps_trim()}} and \code{\link[=ps_refit]{ps_refit()}} for removing extreme values vs. bounding
}
