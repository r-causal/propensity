% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ipw.R
\name{ipw}
\alias{ipw}
\alias{as.data.frame.ipw}
\title{Inverse Probability Weights for Causal Inference}
\usage{
ipw(
  ps_mod,
  outcome_mod,
  .df = NULL,
  estimand = NULL,
  ps_link = NULL,
  conf_level = 0.95
)

\method{as.data.frame}{ipw}(x, row.names = NULL, optional = NULL, exponentiate = FALSE, ...)
}
\arguments{
\item{ps_mod}{A fitted propensity score model of class \code{\link[stats:glm]{stats::glm()}},
typically a logistic regression with the exposure as the dependent
variable.}

\item{outcome_mod}{A fitted, weighted outcome model of class \code{\link[stats:glm]{stats::glm()}}
or \code{\link[stats:lm]{stats::lm()}}, with the outcome as the dependent variable.}

\item{.df}{A data frame containing the exposure, outcome, and covariates. If
\code{NULL}, \code{ipw()} will try to extract the data from \code{ps_mod} and
\code{outcome_mod}.}

\item{estimand}{A character string specifying the causal estimand: \code{ate},
\code{att}, \code{ato}, or \code{atm}. If \code{NULL}, the function attempts to infer it from
existing weights in \code{outcome_mod}, assuming the were calculated with
\code{\link[=wt_ate]{wt_ate()}}, \code{\link[=wt_att]{wt_att()}}, \code{\link[=wt_atm]{wt_atm()}}, or \code{\link[=wt_ato]{wt_ato()}}.}

\item{ps_link}{A character string specifying the link function for the
propensity score model: \code{logit}, \code{probit}, or \code{cloglog}. Defaults to
whatever link was used by \code{ps_mod}.}

\item{conf_level}{Numeric. Confidence level for intervals (default \code{0.95}).}

\item{x}{an \code{ipw} object}

\item{row.names, optional, ...}{Passed to \code{as.data.frame()}.}

\item{exponentiate}{Logical. Should the log-RR and log-OR be exponentiated?}
}
\value{
An S3 object of class \code{ipw} containing:
\itemize{
\item \code{estimand}: One of \code{"ate"}, \code{"att"}, \code{"ato"}, or \code{"atm"}.
\item \code{ps_mod}: The fitted propensity score model.
\item \code{outcome_mod}: The fitted outcome model.
\item \code{estimates}: A data frame of point estimates, standard errors, z-statistics,
confidence intervals, and p-values.
}
}
\description{
\code{ipw()} is a bring-your-own-model (BYOM) inverse probability weighted
estimator. \code{ipw()} accepts a propensity score model and a weighted outcome
model that you have already fit. The purpose of \code{ipw()} is to capture the
uncertainty inherent to this two-step process and calculate the correct
standard errors for each estimate. Currently, \code{ipw()} supports binary
exposures and either binary or continuous outcomes. For binary outcomes,
\code{ipw()} calculates the marginal risk difference, log risk ratio, and log odds
ratio. For continuous outcomes, \code{ipw()} only calculates the marginal
difference in means.
}
\details{
The function constructs inverse probability weights based on the
chosen \code{estimand}, then uses these weights (or extracts them from
\code{outcome_mod}) to compute effect measures:
\itemize{
\item \code{rd}: Risk difference
\item \code{log(rr)}: Log risk ratio
\item \code{log(or)}: Log odds ratio

For a linear outcome model (using \code{\link[stats:lm]{stats::lm()}} or \code{\link[stats:glm]{stats::glm()}} with
\code{family = gaussian()}), only the difference in means (\code{diff}) is returned.
}

\strong{Variance Estimation}

The variance is estimated via linearization, which provide variance
estimates for IPW that correctly account for the uncertainty in estimation
of the propensity scores. For more details on various types of propensity
score weights and their corresponding variance estimators, see:
\itemize{
\item \emph{Kostouraki A, Hajage D, Rachet B, et al. On variance estimation of the inverse
probability-of-treatment weighting estimator: A tutorial for different
types of propensity score weights. Statistics in Medicine. 2024; 43(13):
2672-2694. doi: \href{https://doi.org/10.1002/sim.10078}{10.1002/sim.10078}}
}
}
\examples{
set.seed(123)
n <- 100
# confounder
x1 <- rnorm(n)
# exposure
z  <- rbinom(n, 1, plogis(0.2 * x1))
# binary outcome
y  <- rbinom(n, 1, plogis(1 + 2*z + 0.5*x1))

dat <- data.frame(x1, z, y)

# fit a propensity score model (exposure ~ x1)
ps_mod <- glm(z ~ x1, data = dat, family = binomial())

# calculate weights for ATE
ps <- predict(ps_mod, type = "response")
wts <- wt_ate(ps, z)

# fit an outcome model (binary y ~ z) using IPW
outcome_mod <- glm(y ~ z, data = dat, family = binomial(), weights = wts)

# run IPW
ipw_res <- ipw(ps_mod, outcome_mod)

ipw_res

# Convert to a data frame with exponentiated RR/OR
ipw_res_df <- as.data.frame(ipw_res, exponentiate = TRUE)
ipw_res_df

}
\seealso{
\code{\link[stats:glm]{stats::glm()}}, \code{\link[stats:lm]{stats::lm()}}
}
