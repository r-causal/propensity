<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Propensity Score Weights for Causal Inference — wt_ate • propensity</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Propensity Score Weights for Causal Inference — wt_ate"><meta name="description" content='This family of functions computes propensity score weights for
various causal estimands:
ATE (Average Treatment Effect)
ATT (Average Treatment Effect on the Treated)
ATU (Average Treatment Effect on the Untreated, sometimes called
the ATC, where the "C" stands for "control")
ATM (Average Treatment Effect for the Evenly Matchable)
ATO (Average Treatment Effect for the Overlap population)
Entropy (Average Treatment Effect for the Entropy-weighted population)
The propensity score can be provided as a numeric vector of predicted
probabilities or as a data.frame where each column represents the
predicted probability for a level of the exposure. They can also be
propensity score objects created by ps_trim(), ps_refit(), or
ps_trunc()
The returned weights are encapsulated in a psw object, which is a numeric
vector with additional attributes that record the estimand, and whether the
weights have been stabilized, trimmed, or truncated.

'><meta property="og:description" content='This family of functions computes propensity score weights for
various causal estimands:
ATE (Average Treatment Effect)
ATT (Average Treatment Effect on the Treated)
ATU (Average Treatment Effect on the Untreated, sometimes called
the ATC, where the "C" stands for "control")
ATM (Average Treatment Effect for the Evenly Matchable)
ATO (Average Treatment Effect for the Overlap population)
Entropy (Average Treatment Effect for the Entropy-weighted population)
The propensity score can be provided as a numeric vector of predicted
probabilities or as a data.frame where each column represents the
predicted probability for a level of the exposure. They can also be
propensity score objects created by ps_trim(), ps_refit(), or
ps_trunc()
The returned weights are encapsulated in a psw object, which is a numeric
vector with additional attributes that record the estimand, and whether the
weights have been stabilized, trimmed, or truncated.

'><meta property="og:image" content="https://r-causal.github.io/propensity/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">propensity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/malcolmbarrett/propensity/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate Propensity Score Weights for Causal Inference</h1>
      <small class="dont-index">Source: <a href="https://github.com/malcolmbarrett/propensity/blob/main/R/weights.R" class="external-link"><code>R/weights.R</code></a></small>
      <div class="d-none name"><code>wt_ate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This family of functions computes propensity score weights for
various causal estimands:</p><ul><li><p><strong>ATE</strong> (Average Treatment Effect)</p></li>
<li><p><strong>ATT</strong> (Average Treatment Effect on the Treated)</p></li>
<li><p><strong>ATU</strong> (Average Treatment Effect on the Untreated, sometimes called
the <strong>ATC</strong>, where the "C" stands for "control")</p></li>
<li><p><strong>ATM</strong> (Average Treatment Effect for the Evenly Matchable)</p></li>
<li><p><strong>ATO</strong> (Average Treatment Effect for the Overlap population)</p></li>
<li><p><strong>Entropy</strong> (Average Treatment Effect for the Entropy-weighted population)</p>
<p>The propensity score can be provided as a numeric vector of predicted
probabilities or as a <code>data.frame</code> where each column represents the
predicted probability for a level of the exposure. They can also be
propensity score objects created by <code><a href="ps_trim.html">ps_trim()</a></code>, <code><a href="ps_refit.html">ps_refit()</a></code>, or
<code><a href="ps_trunc.html">ps_trunc()</a></code></p>
<p>The returned weights are encapsulated in a <code>psw</code> object, which is a numeric
vector with additional attributes that record the estimand, and whether the
weights have been stabilized, trimmed, or truncated.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">wt_ate</span><span class="op">(</span></span>
<span>  <span class="va">.propensity</span>,</span>
<span>  <span class="va">.exposure</span>,</span>
<span>  .sigma <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  exposure_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"binary"</span>, <span class="st">"categorical"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  .treated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .untreated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stabilize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  stabilization_score <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">wt_att</span><span class="op">(</span></span>
<span>  <span class="va">.propensity</span>,</span>
<span>  <span class="va">.exposure</span>,</span>
<span>  exposure_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"binary"</span>, <span class="st">"categorical"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  .treated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .untreated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">wt_atu</span><span class="op">(</span></span>
<span>  <span class="va">.propensity</span>,</span>
<span>  <span class="va">.exposure</span>,</span>
<span>  exposure_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"binary"</span>, <span class="st">"categorical"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  .treated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .untreated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">wt_atm</span><span class="op">(</span></span>
<span>  <span class="va">.propensity</span>,</span>
<span>  <span class="va">.exposure</span>,</span>
<span>  exposure_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"binary"</span>, <span class="st">"categorical"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  .treated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .untreated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">wt_ato</span><span class="op">(</span></span>
<span>  <span class="va">.propensity</span>,</span>
<span>  <span class="va">.exposure</span>,</span>
<span>  exposure_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"binary"</span>, <span class="st">"categorical"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  .treated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .untreated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">wt_entropy</span><span class="op">(</span></span>
<span>  <span class="va">.propensity</span>,</span>
<span>  <span class="va">.exposure</span>,</span>
<span>  exposure_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"binary"</span>, <span class="st">"categorical"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  .treated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .untreated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--propensity">.propensity<a class="anchor" aria-label="anchor" href="#arg--propensity"></a></dt>
<dd><p>Either a numeric vector of predicted probabilities or a
<code>data.frame</code> where each column corresponds to a level of the exposure.</p></dd>


<dt id="arg--exposure">.exposure<a class="anchor" aria-label="anchor" href="#arg--exposure"></a></dt>
<dd><p>The exposure variable. For binary exposures, a vector of 0s
and 1s; for continuous exposures, a numeric vector.</p></dd>


<dt id="arg--sigma">.sigma<a class="anchor" aria-label="anchor" href="#arg--sigma"></a></dt>
<dd><p>For continuous exposures, a numeric vector of standard errors
used with <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm()</a></code>. For example, this can be derived from the influence
measures of a model (e.g., <code>influence(model)$sigma</code>).</p></dd>


<dt id="arg-exposure-type">exposure_type<a class="anchor" aria-label="anchor" href="#arg-exposure-type"></a></dt>
<dd><p>Character string specifying the type of exposure.
Options are <code>"auto"</code>, <code>"binary"</code>, <code>"categorical"</code>, and <code>"continuous"</code>.
Defaults to <code>"auto"</code>, which detects the type automatically.</p></dd>


<dt id="arg--treated">.treated<a class="anchor" aria-label="anchor" href="#arg--treated"></a></dt>
<dd><p>The value representing the treatment group. If not provided,
it is automatically detected.</p></dd>


<dt id="arg--untreated">.untreated<a class="anchor" aria-label="anchor" href="#arg--untreated"></a></dt>
<dd><p>The value representing the control group. If not provided,
it is automatically detected.</p></dd>


<dt id="arg-stabilize">stabilize<a class="anchor" aria-label="anchor" href="#arg-stabilize"></a></dt>
<dd><p>Logical indicating whether to stabilize the weights. For ATE
weights, stabilization multiplies the weight by either the mean of
<code>.exposure</code> or the supplied <code>stabilization_score</code>.</p></dd>


<dt id="arg-stabilization-score">stabilization_score<a class="anchor" aria-label="anchor" href="#arg-stabilization-score"></a></dt>
<dd><p>Optional numeric value for stabilizing the weights
(e.g., a predicted value from a regression model without predictors). Only
used when <code>stabilize</code> is <code>TRUE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Reserved for future expansion. Not currently used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>psw</code> object (a numeric vector) with additional attributes:</p><ul><li><p><strong>estimand</strong>: A description of the estimand (e.g., "ate", "att").</p></li>
<li><p><strong>stabilized</strong>: A logical flag indicating if stabilization was applied.</p></li>
<li><p><strong>trimmed</strong>: A logical flag indicating if the weights are based on trimmed propensity scores.</p></li>
<li><p><strong>truncated</strong>: A logical flag indicating if the weights are based on truncated propensity scores.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="exposure-types">Exposure Types<a class="anchor" aria-label="anchor" href="#exposure-types"></a></h3>


<p>The functions support different types of exposures:</p><ul><li><p><strong><code>binary</code></strong>: For dichotomous treatments (e.g. 0/1).</p></li>
<li><p><strong><code>continuous</code></strong>: For numeric exposures. Here, weights are calculated via the normal density using
<code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm()</a></code>.</p></li>
<li><p><strong><code>categorical</code></strong>: Currently not supported (an error will be raised).</p></li>
<li><p><strong><code>auto</code></strong>: Automatically detects the exposure type based on <code>.exposure</code>.</p></li>
</ul><div class="section">
<h4 id="stabilization">Stabilization<a class="anchor" aria-label="anchor" href="#stabilization"></a></h4>


<p>For ATE weights, stabilization can improve the performance of the estimator
by reducing variance. When <code>stabilize</code> is <code>TRUE</code> and no
<code>stabilization_score</code> is provided, the weights are multiplied by the mean
of <code>.exposure</code>. Alternatively, if a <code>stabilization_score</code> is provided, it
is used as the multiplier.</p>
</div>

<div class="section">
<h4 id="trimmed-and-truncated-weights">Trimmed and Truncated Weights<a class="anchor" aria-label="anchor" href="#trimmed-and-truncated-weights"></a></h4>


<p>In addition to the standard weight functions, versions exist for trimmed
and truncated propensity score weights created by <code><a href="ps_trim.html">ps_trim()</a></code>,
<code><a href="ps_trunc.html">ps_trunc()</a></code>, and <code><a href="ps_refit.html">ps_refit()</a></code>. These variants calculate the weights using
modified propensity scores (trimmed or truncated) and update the estimand
attribute accordingly.</p>
<p>The main functions (<code>wt_ate</code>, <code>wt_att</code>, <code>wt_atu</code>, <code>wt_atm</code>, and <code>wt_ato</code>)
dispatch on the class of <code>.propensity</code>. For binary exposures, the weights
are computed using inverse probability formulas. For continuous exposures
(supported only for ATE), weights are computed as the inverse of the
density function evaluated at the observed exposure.</p>
</div>

</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="psw.html">psw()</a></code> for details on the structure of the returned weight objects.</p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## ATE Weights with a Binary Exposure</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate a binary treatment and corresponding propensity scores</span></span></span>
<span class="r-in"><span><span class="va">propensity_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.7</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute ATE weights (unstabilized)</span></span></span>
<span class="r-in"><span><span class="va">weights_ate</span> <span class="op">&lt;-</span> <span class="fu">wt_ate</span><span class="op">(</span><span class="va">propensity_scores</span>, .exposure <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Treating `.exposure` as binary</span>
<span class="r-in"><span><span class="va">weights_ate</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;psw{estimand = ate}[4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.250000 1.428571 2.000000 1.250000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute ATE weights with stabilization using the mean of the exposure</span></span></span>
<span class="r-in"><span><span class="va">weights_ate_stab</span> <span class="op">&lt;-</span> <span class="fu">wt_ate</span><span class="op">(</span><span class="va">propensity_scores</span>, .exposure <span class="op">=</span> <span class="va">treatment</span>, stabilize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Treating `.exposure` as binary</span>
<span class="r-in"><span><span class="va">weights_ate_stab</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;psw{estimand = ate; stabilized}[4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.6250000 0.7142857 1.0000000 0.6250000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ATT Weights for a Binary Exposure</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">propensity_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute ATT weights</span></span></span>
<span class="r-in"><span><span class="va">weights_att</span> <span class="op">&lt;-</span> <span class="fu">wt_att</span><span class="op">(</span><span class="va">propensity_scores</span>, .exposure <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Treating `.exposure` as binary</span>
<span class="r-in"><span><span class="va">weights_att</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;psw{estimand = att}[4]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.0000000 1.0000000 0.6666667 2.3333333</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Malcolm Barrett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

