<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Refit a Propensity Score Model on Retained Observations — ps_refit • propensity</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Refit a Propensity Score Model on Retained Observations — ps_refit"><meta name="description" content="Re-estimates a propensity score model using only the observations retained
after trimming. This is the recommended intermediate step between
ps_trim() and weight calculation (e.g. wt_ate()):
ps_trim() -&amp;gt; ps_refit() -&amp;gt; wt_*()
Trimming changes the target population by removing observations with extreme
propensity scores. Refitting the model on the retained subset produces
propensity scores that better reflect this population, improving both model
fit and downstream weight estimation. Weight functions warn if a trimmed
propensity score has not been refit."><meta property="og:description" content="Re-estimates a propensity score model using only the observations retained
after trimming. This is the recommended intermediate step between
ps_trim() and weight calculation (e.g. wt_ate()):
ps_trim() -&amp;gt; ps_refit() -&amp;gt; wt_*()
Trimming changes the target population by removing observations with extreme
propensity scores. Refitting the model on the retained subset produces
propensity scores that better reflect this population, improving both model
fit and downstream weight estimation. Weight functions warn if a trimmed
propensity score has not been refit."><meta property="og:image" content="https://r-causal.github.io/propensity/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">propensity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/propensity.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-causal/propensity/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Refit a Propensity Score Model on Retained Observations</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-causal/propensity/blob/main/R/ps_trim.R" class="external-link"><code>R/ps_trim.R</code></a></small>
      <div class="d-none name"><code>ps_refit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Re-estimates a propensity score model using only the observations retained
after trimming. This is the recommended intermediate step between
<code><a href="ps_trim.html">ps_trim()</a></code> and weight calculation (e.g. <code><a href="wt_ate.html">wt_ate()</a></code>):</p>
<p><strong><code><a href="ps_trim.html">ps_trim()</a></code> -&gt; <code>ps_refit()</code> -&gt; <code>wt_*()</code></strong></p>
<p>Trimming changes the target population by removing observations with extreme
propensity scores. Refitting the model on the retained subset produces
propensity scores that better reflect this population, improving both model
fit and downstream weight estimation. Weight functions warn if a trimmed
propensity score has not been refit.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ps_refit</span><span class="op">(</span><span class="va">trimmed_ps</span>, <span class="va">model</span>, .data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-trimmed-ps">trimmed_ps<a class="anchor" aria-label="anchor" href="#arg-trimmed-ps"></a></dt>
<dd><p>A <code>ps_trim</code> object returned by <code><a href="ps_trim.html">ps_trim()</a></code>.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The original fitted model used to estimate the propensity
scores (e.g. a <a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a> or <a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a> object).
The model is refit via <a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a> on the retained subset.</p></dd>


<dt id="arg--data">.data<a class="anchor" aria-label="anchor" href="#arg--data"></a></dt>
<dd><p>A data frame. If <code>NULL</code> (the default), the data are extracted
from <code>model</code> via <a href="https://rdrr.io/r/stats/model.frame.html" class="external-link">model.frame()</a>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>ps_trim</code> object with re-estimated propensity scores for retained
observations and <code>NA</code> for trimmed observations. Use <code><a href="is_refit.html">is_refit()</a></code> to
confirm refitting was applied.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="ps_trim.html">ps_trim()</a></code> for the trimming step, <code><a href="is_refit.html">is_refit()</a></code> to check refit
status, <code><a href="wt_ate.html">wt_ate()</a></code> and other weight functions for the next step in the
pipeline.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fl">0.4</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a propensity score model</span></span></span>
<span class="r-in"><span><span class="va">ps_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">z</span> <span class="op">~</span> <span class="va">x</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ps_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># trim -&gt; refit -&gt; weight pipeline</span></span></span>
<span class="r-in"><span><span class="va">trimmed</span> <span class="op">&lt;-</span> <span class="fu"><a href="ps_trim.html">ps_trim</a></span><span class="op">(</span><span class="va">ps</span>, lower <span class="op">=</span> <span class="fl">0.1</span>, upper <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">refit</span> <span class="op">&lt;-</span> <span class="fu">ps_refit</span><span class="op">(</span><span class="va">trimmed</span>, <span class="va">ps_model</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">wts</span> <span class="op">&lt;-</span> <span class="fu"><a href="wt_ate.html">wt_ate</a></span><span class="op">(</span><span class="va">refit</span>, .exposure <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Treating `.exposure` as binary</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Setting focal level to <span style="color: #0000BB;">1</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="is_refit.html">is_refit</a></span><span class="op">(</span><span class="va">refit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Malcolm Barrett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

