<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Trim Propensity Scores — ps_trim • propensity</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Trim Propensity Scores — ps_trim"><meta name="description" content="ps_trim() applies trimming methods to a propensity-score vector or matrix,
returning a new vector/matrix of the same length/dimensions, with trimmed
entries replaced by NA. You can inspect further metadata in ps_trim_meta(x).
After running ps_trim(), you should refit the model with ps_refit()."><meta property="og:description" content="ps_trim() applies trimming methods to a propensity-score vector or matrix,
returning a new vector/matrix of the same length/dimensions, with trimmed
entries replaced by NA. You can inspect further metadata in ps_trim_meta(x).
After running ps_trim(), you should refit the model with ps_refit()."><meta property="og:image" content="https://r-causal.github.io/propensity/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">propensity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/malcolmbarrett/propensity/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Trim Propensity Scores</h1>
      <small class="dont-index">Source: <a href="https://github.com/malcolmbarrett/propensity/blob/main/R/ps_trim.R" class="external-link"><code>R/ps_trim.R</code></a></small>
      <div class="d-none name"><code>ps_trim.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>ps_trim()</code> applies trimming methods to a propensity-score vector or matrix,
returning a new vector/matrix of the <em>same length/dimensions</em>, with trimmed
entries replaced by <code>NA.</code> You can inspect further metadata in <code>ps_trim_meta(x)</code>.
After running <code>ps_trim()</code>, you should refit the model with <code><a href="ps_refit.html">ps_refit()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ps_trim</span><span class="op">(</span></span>
<span>  <span class="va">ps</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ps"</span>, <span class="st">"adaptive"</span>, <span class="st">"pctl"</span>, <span class="st">"pref"</span>, <span class="st">"cr"</span>, <span class="st">"optimal"</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  upper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .exposure <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .treated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .untreated <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-ps">ps<a class="anchor" aria-label="anchor" href="#arg-ps"></a></dt>
<dd><p>The propensity score, either a numeric vector between 0 and 1 for
binary exposures, or a matrix/data.frame where each column represents
propensity scores for each level of a categorical exposure.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>One of <code>c("ps", "adaptive", "pctl", "pref", "cr", "optimal")</code>.
For categorical exposures, only <code>"ps"</code> and <code>"optimal"</code> are supported.</p></dd>


<dt id="arg-lower-upper">lower, upper<a class="anchor" aria-label="anchor" href="#arg-lower-upper"></a></dt>
<dd><p>Numeric cutoffs or quantiles. If <code>NULL</code>, defaults vary by
method. For categorical exposures with method <code>"ps"</code>, <code>lower</code> represents the
symmetric trimming threshold (delta).</p></dd>


<dt id="arg--exposure">.exposure<a class="anchor" aria-label="anchor" href="#arg--exposure"></a></dt>
<dd><p>For methods like <code>"pref"</code> or <code>"cr"</code>, a vector for a binary
exposure. For categorical exposures with method <code>"optimal"</code>, must be a
factor or character vector.</p></dd>


<dt id="arg--treated">.treated<a class="anchor" aria-label="anchor" href="#arg--treated"></a></dt>
<dd><p>The value representing the treatment group. If not provided,
it is automatically detected.</p></dd>


<dt id="arg--untreated">.untreated<a class="anchor" aria-label="anchor" href="#arg--untreated"></a></dt>
<dd><p>The value representing the control group. If not provided,
it is automatically detected.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to methods</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>ps_trim</code> object (numeric vector or matrix). The attribute
<code>ps_trim_meta</code> stores metadata.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The returned object is a <strong><code>ps_trim</code></strong> vector/matrix of the same
length/dimensions as <code>ps</code>, but with trimmed entries replaced by <code>NA</code>. An
attribute <code>ps_trim_meta</code> contains:</p><ul><li><p><code>method</code>: Which trimming method was used</p></li>
<li><p><code>keep_idx</code>: Indices retained</p></li>
<li><p><code>trimmed_idx</code>: Indices replaced by <code>NA</code></p></li>
<li><p>Possibly other fields such as final cutoffs, etc.</p></li>
</ul><p>For categorical exposures:</p><ul><li><p><strong>Symmetric trimming</strong> (<code>method = "ps"</code>): Removes observations where any
propensity score falls below the threshold delta (specified via <code>lower</code>).</p></li>
<li><p><strong>Optimal trimming</strong> (<code>method = "optimal"</code>): Uses the Yang et al. (2016)
approach for multi-category treatments.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="ps_trunc.html">ps_trunc()</a></code> for bounding/winsorizing instead of discarding,
<code><a href="is_refit.html">is_refit()</a></code>, <code><a href="is_ps_trimmed.html">is_ps_trimmed()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">300</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fl">1.3</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">z</span> <span class="op">~</span> <span class="va">x</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">ps_trim</span><span class="op">(</span><span class="va">ps</span>, method <span class="op">=</span> <span class="st">"adaptive"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;ps_trim; trimmed 44 of [300]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         1         2         3         4         5         6         7         8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1780112 0.4934483 0.8725819 0.1353577 0.4025855 0.4752489 0.6683913 0.3506150 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         9        10        11        12        13        14        15        16 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        NA 0.3831809 0.5738044 0.7467782 0.3038553 0.1508037 0.8997256        NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        17        18        19        20        21        22        23        24 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.7187207 0.4419184 0.7548592 0.5787647        NA 0.1244366 0.8728587        NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        25        26        27        28        29        30        31        32 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.4313639        NA 0.5939254 0.2474276 0.6938170 0.5298266 0.6778670 0.5399668 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        33        34        35        36        37        38        39        40 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.7707828 0.3366773 0.2037945 0.2476600        NA 0.1768609 0.2572600 0.3484614 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        41        42        43        44        45        46        47        48 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3065403        NA 0.1895191        NA 0.6415565        NA 0.3300895 0.3990495 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        49        50        51        52        53        54        55        56 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3683877 0.1246121 0.1902500        NA 0.2564150 0.8160957 0.1494022        NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        57        58        59        60        61        62        63        64 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3247367 0.7345271 0.7859021 0.8849770        NA        NA 0.2208817 0.4841803 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        65        66        67        68        69        70        71        72 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.6036086 0.1941979        NA 0.2790100 0.4585602 0.1783019 0.1731103 0.5439312 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        73        74        75        76        77        78        79        80 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3822372 0.5796397 0.4114856 0.1759469 0.8218240 0.6877562 0.7649259        NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        81        82        83        84        85        86        87        88 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.7505008        NA 0.2641422 0.1005949        NA        NA 0.2330120 0.3365148 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        89        90        91        92        93        94        95        96 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3055473 0.5632496 0.8745082 0.8863194 0.1269292 0.1023453        NA 0.1166039 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        97        98        99       100       101       102       103       104 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        NA 0.4322875 0.1893249 0.2462384 0.7703638 0.5197606 0.3273939 0.2099624 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       105       106       107       108       109       110       111       112 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1851823        NA 0.7356255        NA 0.2954896 0.3163021 0.1530042 0.3471981 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       113       114       115       116       117       118       119       120 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.5921212 0.8328274 0.6227067 0.5867797 0.8065734 0.7877456 0.4663064 0.2023006 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       121       122       123       124       125       126       127       128 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.8087856 0.4774812 0.8903829 0.2928150 0.1499937 0.6139848 0.2290136 0.6467536 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       129       130       131       132       133       134       135       136 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        NA        NA 0.6627758 0.5441083 0.7165979        NA 0.8025574 0.7998822 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       137       138       139       140       141       142       143       144 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.7597742 0.6921037        NA        NA 0.2509264 0.5711077 0.1970442 0.4590332 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       145       146       147       148       149       150       151       152 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.6800801 0.2329425 0.6525433 0.6180388 0.1970997 0.1584870 0.7452343 0.3731672 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       153       154       155       156       157       158       159       160 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.6727629 0.1889404 0.8164247 0.1043218 0.6858279 0.5895482 0.5223260 0.6558189 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       161       162       163       164       165       166       167       168 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.5672709 0.2368400 0.3418011 0.5540597 0.1083159 0.1806594        NA        NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       169       170       171       172       173       174       175       176 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1187105 0.7490531 0.7738375 0.7077039 0.4491471 0.5416643 0.1764396 0.2333126 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       177       178       179       180       181       182       183       184 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3434474 0.1704628 0.7023006        NA 0.1524604 0.1153463 0.5651259 0.1351849 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       185       186       187       188       189       190       191       192 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.6161453 0.7945146 0.4382952 0.6065642 0.2328341 0.6027459 0.1139088 0.4037497 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       193       194       195       196       197       198       199       200 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1040353 0.3422376 0.7735701 0.6661116 0.2893391 0.2011360 0.1863223 0.2107038 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       201       202       203       204       205       206       207       208 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.5327159 0.1544197        NA 0.5052145 0.1642856 0.5622725 0.3887452 0.3163883 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       209       210       211       212       213       214       215       216 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.6341619 0.5095796 0.7582940 0.2665601        NA        NA 0.4774214 0.5852567 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       217       218       219       220       221       222       223       224 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.8030404 0.1067663 0.1338595 0.8855459 0.5671613 0.6707177 0.2000938        NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       225       226       227       228       229       230       231       232 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.4538222 0.5912550 0.3993802 0.7230688 0.3094663        NA 0.8702859        NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       233       234       235       236       237       238       239       240 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.2415827 0.4195113        NA 0.1483657 0.2541910 0.5957602 0.4626159 0.2496911 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       241       242       243       244       245       246       247       248 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.4020747        NA 0.7936546 0.6179515 0.6899355 0.2556513 0.4650462 0.5270157 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       249       250       251       252       253       254       255       256 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.2803714 0.2850014 0.6020472 0.3002118 0.3705819 0.3257820 0.7087374 0.5960756 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       257       258       259       260       261       262       263       264 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3306472 0.3363861 0.7464321 0.3725508 0.8297224 0.3965473 0.3250342        NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       265       266       267       268       269       270       271       272 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.2345937        NA        NA 0.5886632 0.6106387 0.4172303        NA 0.4137080 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       273       274       275       276       277       278       279       280 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.4312953 0.1206438 0.5164038 0.8752400 0.4176263 0.7591012 0.3016993 0.4527210 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       281       282       283       284       285       286       287       288 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        NA 0.6501483 0.8168531 0.2393292 0.8311549 0.8851143 0.7936328 0.4317872 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       289       290       291       292       293       294       295       296 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.8222307 0.3983355 0.1356224 0.6302455 0.4602807 0.3527491 0.8562989 0.3153233 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       297       298       299       300 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.5741435        NA 0.1008201 0.2253829 </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Malcolm Barrett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

